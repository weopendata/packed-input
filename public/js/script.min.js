function enablingSwitches(){var e=$(this).closest(".row");$("input",$(this)).is(":checked")?$("input",e).prop("disabled",!1):$("input",e).prop("disabled",!0),$("input",this).prop("disabled",!1)}function buildQueryObj(){queryObj={},$("form input").not("input[id*=enabled], input[type=submit]").each(function(){var e=$(this);e.prop("disabled")||(queryObj[e.attr("id")]=e.val())}),history.replaceState({},"PID demonstrator","?"+$.param(queryObj))}function init(){var e=$.getQueryParameters(),t=Object.keys(e);if(t.length>0&&""!=t[0]){$(".form-enabler-switch input").each(function(){$(this).prop("checked",!1);var e=$(this).closest(".row");$("input:not(input[type=checkbox])",e).prop("disabled",!0)});for(var n in e){var r=e[n];$("#"+n).val(decodeURIComponent(r).replace(/\+/g," "));var i=$("#"+n).closest(".row.parent");$("input[type=checkbox]",i).prop("checked",!0),$("input",i).prop("disabled",!1)}$("form").submit()}buildQueryObj()}function search(e){e.preventDefault();var t=angular.element($("#results")).scope(),n=$(e.target),r=$("button[type=submit]",n);r.prop("disabled",!0),$(".row",n).removeClass("error"),$("#searchStatus",n).html(""),t.reset(),buildQueryObj();var i={},s=!0,o=!1;$("form input[data-property]:not(:disabled)").each(function(){var e=$(this).val();i[$(this).data("property")]=e,e&&""!=e||($(this).closest(".row").addClass("error"),s=!1),o=!0}),s?o?($("#results").show(),$(".fa-spin").removeClass("hidden").stop().fadeIn(),t.loadWorks(i)):($("#searchStatus",n).html("Kies minstens één van de bovenstaande filters."),resetForm()):resetForm()}function resetForm(){var e=$("button[type=submit]");e.prop("disabled",!1)}function updateSearchStatus(e){var t=e.length;status=0==t?"Geen resultaten":1==t?"1 resultaat":t+" resultaten",$("#searchStatus").html(status+" gevonden.")}$(".form-enabler-switch").each(enablingSwitches),$(".form-enabler-switch").on("change",enablingSwitches),$(".switch").on("change",buildQueryObj),$("form").on("submit",search);var queryObj={};jQuery.extend({getQueryParameters:function(e){return(e||document.location.search).replace(/(^\?)/,"").split("&").map(function(e){return e=e.split("="),this[e[0]]=e[1],this}.bind({}))[0]}}),$(document).ready(function(){init()});var cache={};$("input[data-autocomplete]").each(function(){var e=$(this);e.autocomplete({minLength:2,source:function(t,n){var r={},i=e.data("property");r.index="false"==queryObj.index?"false":"true",r[i]=t.term;var s=i+t.term+r.index;return s in cache?void n(cache[s]):void $.getJSON(baseURL+"suggest?",r,function(e,t,r){cache[s]=e,n(e)})}}).keyup(function(e){13===e.which&&$(".ui-autocomplete").hide()})}),function(e,t){"use strict";var n=e.document,r;r=function(){var r={},i={},s=!1,o={ENTER:13,ESC:27,SPACE:32},a=[],l,u,c,d,f,p,h,y,m,b,v,g,$;return i={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',ok:'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',cancel:'<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},$=function(){var e,r,i=!1,s=n.createElement("fakeelement"),o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(e in o)if(s.style[e]!==t){r=o[e],i=!0;break}return{type:r,supported:i}},l=function(e){return n.getElementById(e)},r={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,buttonReverse:!1,buttonFocus:"ok",transition:t,addListeners:function(e){var t="undefined"!=typeof c,r="undefined"!=typeof u,i="undefined"!=typeof g,s="",a=this,l,p,h,y,m;l=function(t){return"undefined"!=typeof t.preventDefault&&t.preventDefault(),h(t),"undefined"!=typeof g&&(s=g.value),"function"==typeof e&&("undefined"!=typeof g?e(!0,s):e(!0)),!1},p=function(t){return"undefined"!=typeof t.preventDefault&&t.preventDefault(),h(t),"function"==typeof e&&e(!1),!1},h=function(e){a.hide(),a.unbind(n.body,"keyup",y),a.unbind(d,"focus",m),t&&a.unbind(c,"click",l),r&&a.unbind(u,"click",p)},y=function(e){var t=e.keyCode;(t===o.SPACE&&!i||i&&t===o.ENTER)&&l(e),t===o.ESC&&r&&p(e)},m=function(e){i?g.focus():!r||a.buttonReverse?c.focus():u.focus()},this.bind(d,"focus",m),this.bind(f,"focus",m),t&&this.bind(c,"click",l),r&&this.bind(u,"click",p),this.bind(n.body,"keyup",y),this.transition.supported||this.setFocus()},bind:function(e,t,n){"function"==typeof e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},handleErrors:function(){if("undefined"!=typeof e.onerror){var t=this;return e.onerror=function(e,n,r){t.error("["+e+" on line "+r+" of "+n+"]",0)},!0}return!1},appendButtons:function(e,t){return this.buttonReverse?t+e:e+t},build:function(e){var t="",n=e.type,s=e.message,o=e.cssClass||"";switch(t+='<div class="alertify-dialog">',t+='<a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus</a>',"none"===r.buttonFocus&&(t+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>'),"prompt"===n&&(t+='<div id="alertify-form">'),t+='<article class="alertify-inner">',t+=i.message.replace("{{message}}",s),"prompt"===n&&(t+=i.input),t+=i.buttons.holder,t+="</article>","prompt"===n&&(t+="</div>"),t+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',t+="</div>",n){case"confirm":t=t.replace("{{buttons}}",this.appendButtons(i.buttons.cancel,i.buttons.ok)),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":t=t.replace("{{buttons}}",this.appendButtons(i.buttons.cancel,i.buttons.submit)),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":t=t.replace("{{buttons}}",i.buttons.ok),t=t.replace("{{ok}}",this.labels.ok)}return m.className="alertify alertify-"+n+" "+o,y.className="alertify-cover",t},close:function(e,t){var n=t&&!isNaN(t)?+t:this.delay,r=this,i,s;this.bind(e,"click",function(){i(e)}),s=function(e){e.stopPropagation(),r.unbind(this,r.transition.type,s),b.removeChild(this),b.hasChildNodes()||(b.className+=" alertify-logs-hidden")},i=function(e){"undefined"!=typeof e&&e.parentNode===b&&(r.transition.supported?(r.bind(e,r.transition.type,s),e.className+=" alertify-log-hide"):(b.removeChild(e),b.hasChildNodes()||(b.className+=" alertify-logs-hidden")))},0!==t&&setTimeout(function(){i(e)},n)},dialog:function(e,t,r,i,o){h=n.activeElement;var l=function(){b&&null!==b.scrollTop&&y&&null!==y.scrollTop||l()};if("string"!=typeof e)throw new Error("message must be a string");if("string"!=typeof t)throw new Error("type must be a string");if("undefined"!=typeof r&&"function"!=typeof r)throw new Error("fn must be a function");return this.init(),l(),a.push({type:t,message:e,callback:r,placeholder:i,cssClass:o}),s||this.setup(),this},extend:function(e){if("string"!=typeof e)throw new Error("extend method must have exactly one paramter");return function(t,n){return this.log(t,e,n),this}},hide:function(){var e,t=this;a.splice(0,1),a.length>0?this.setup(!0):(s=!1,e=function(n){n.stopPropagation(),t.unbind(m,t.transition.type,e)},this.transition.supported?(this.bind(m,this.transition.type,e),m.className="alertify alertify-hide alertify-hidden"):m.className="alertify alertify-hide alertify-hidden alertify-isHidden",y.className="alertify-cover alertify-cover-hidden",h.focus())},init:function(){n.createElement("nav"),n.createElement("article"),n.createElement("section"),null==l("alertify-cover")&&(y=n.createElement("div"),y.setAttribute("id","alertify-cover"),y.className="alertify-cover alertify-cover-hidden",n.body.appendChild(y)),null==l("alertify")&&(s=!1,a=[],m=n.createElement("section"),m.setAttribute("id","alertify"),m.className="alertify alertify-hidden",n.body.appendChild(m)),null==l("alertify-logs")&&(b=n.createElement("section"),b.setAttribute("id","alertify-logs"),b.className="alertify-logs alertify-logs-hidden",n.body.appendChild(b)),n.body.setAttribute("tabindex","0"),this.transition=$()},log:function(e,t,n){var r=function(){b&&null!==b.scrollTop||r()};return this.init(),r(),b.className="alertify-logs",this.notify(e,t,n),this},notify:function(e,t,r){var i=n.createElement("article");i.className="alertify-log"+("string"==typeof t&&""!==t?" alertify-log-"+t:""),i.innerHTML=e,b.appendChild(i),setTimeout(function(){i.className=i.className+" alertify-log-show"},50),this.close(i,r)},set:function(e){var t;if("object"!=typeof e&&e instanceof Array)throw new Error("args must be an object");for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},setFocus:function(){g?(g.focus(),g.select()):p.focus()},setup:function(e){var n=a[0],i=this,o;s=!0,o=function(e){e.stopPropagation(),i.setFocus(),i.unbind(m,i.transition.type,o)},this.transition.supported&&!e&&this.bind(m,this.transition.type,o),m.innerHTML=this.build(n),d=l("alertify-resetFocus"),f=l("alertify-resetFocusBack"),c=l("alertify-ok")||t,u=l("alertify-cancel")||t,p="cancel"===r.buttonFocus?u:"none"===r.buttonFocus?l("alertify-noneFocus"):c,g=l("alertify-text")||t,v=l("alertify-form")||t,"string"==typeof n.placeholder&&""!==n.placeholder&&(g.value=n.placeholder),e&&this.setFocus(),this.addListeners(n.callback)},unbind:function(e,t,n){"function"==typeof e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}},{alert:function(e,t,n){return r.dialog(e,"alert",t,"",n),this},confirm:function(e,t,n){return r.dialog(e,"confirm",t,"",n),this},extend:r.extend,init:r.init,log:function(e,t,n){return r.log(e,t,n),this},prompt:function(e,t,n,i){return r.dialog(e,"prompt",t,n,i),this},success:function(e,t){return r.log(e,"success",t),this},error:function(e,t){return r.log(e,"error",t),this},set:function(e){r.set(e)},labels:r.labels,debug:r.handleErrors}},"function"==typeof define?define([],function(){return new r}):"undefined"==typeof e.alertify&&(e.alertify=new r)}(this);var app=angular.module("PIDdemonstrator",[]);$("#detailCtrl").hide(),app.controller("ResultCtrl",["$scope","$http","$q",function(e,t,n){var r=n.defer();e.simple_works=[],e.index_works=[],e.normalised_works=[],e.loadWorks=function(i){r.resolve(),r=n.defer(),t({url:baseURL+"query",method:"GET",params:i,timeout:r.promise}).success(function(t,n,r,i){e.normalised_works=t,$(".results-normalised .fa-spin").stop().fadeOut(),resetForm()}).error(function(e,t,n,r){if(e){var i=JSON.parse(e.responseText);i=i.error,alertify.error("An error occurred: "+e.status+" - "+i.message),$(".results-normalised .fa-spin").stop().fadeOut(),resetForm()}});var s=jQuery.extend({type:"index"},i);t({url:baseURL+"query",method:"GET",params:s,timeout:r.promise}).success(function(t,n,r,i){var s={};s.count=t.length,s.results=t,e.index_works=s,$(".results-index .fa-spin").stop().fadeOut(),resetForm()}).error(function(e,t,n,r){if(e){var i=JSON.parse(e.responseText);i=i.error,alertify.error("An error occurred: "+e.status+" - "+i.message),$(".results-index .fa-spin").stop().fadeOut(),resetForm()}});var o=jQuery.extend({type:"simple"},i);t({url:baseURL+"query",method:"GET",params:o,timeout:r.promise}).success(function(t,n,r,i){var s={};s.count=t.length,s.results=t,e.simple_works=s,$(".results-simple .fa-spin").stop().fadeOut(),resetForm()}).error(function(e,t,n,r){if(e){var i=JSON.parse(e.responseText);i=i.error,alertify.error("An error occurred: "+e.status+" - "+i.message),$(".results-simple .fa-spin").stop().fadeOut(),resetForm()}}),e.$apply()},e.viewDetails=function(e){angular.element($("#detailCtrl")).scope().viewDetails(e)},e.reset=function(){$("#detailCtrl").hide(),e.simple_works=[],e.index_works=[],e.normalised_works=[],e.$apply()}}]),app.controller("DetailCtrl",["$scope",function(e){e.enriched=!0,e.work_detail={},e.goBack=function(){$("#detailCtrl").hide(),$("#results").show(),$("#searchForm").show(),e.work_detail={}},e.viewDetails=function(t){console.log(t),$("#searchForm").hide(),$("#results").hide(),$("#detailCtrl").show(),e.work_detail=t}}]),app.filter("resultCount",function(){return function(e){return status=0==e||void 0==e?"Geen werken":1==e?"1 werk":e+" werken",status+" gevonden"}});