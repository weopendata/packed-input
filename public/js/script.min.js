function enablingSwitches(){var e=$(this).closest(".row");$("input",$(this)).is(":checked")?$("input",e).prop("disabled",!1):$("input",e).prop("disabled",!0),$("input",this).prop("disabled",!1)}function buildQueryObj(){queryObj={},$("form input").not("input[id*=enabled], input[type=submit]").each(function(){var e=$(this);e.prop("disabled")||(queryObj[e.attr("id")]=e.val())}),history.replaceState({},"PID demonstrator","?"+$.param(queryObj))}function init(){var e=$.getQueryParameters(),t=Object.keys(e);if(t.length>0&&""!=t[0]){$(".form-enabler-switch input").each(function(){$(this).prop("checked",!1);var e=$(this).closest(".row");$("input:not(input[type=checkbox])",e).prop("disabled",!0)});for(var n in e){var i=e[n];$("#"+n).val(decodeURIComponent(i).replace(/\+/g," "));var r=$("#"+n).closest(".row");$("input[type=checkbox]",r).prop("checked",!0),$("input",r).prop("disabled",!1)}$("form").submit()}buildQueryObj()}function search(e){e.preventDefault();var t=angular.element($("#results")).scope(),n=$(e.target),i=$("button[type=submit]",n);i.prop("disabled",!0),i.html("<i class='fa fa-spin fa-spinner'></i>"),$(".row",n).removeClass("error"),$("#searchStatus",n).html(""),t.reset(),buildQueryObj();var r={},s=!0,a=!1;$("form input[data-property]:not(:disabled)").each(function(){var e=$(this).val();r[$(this).data("property")]=e,e&&""!=e||($(this).closest(".row").addClass("error"),s=!1),a=!0}),s?a?t.loadWorks(r):($("#searchStatus",n).html("Kies minstens één van de bovenstaande filters."),resetForm()):resetForm()}function resetForm(){var e=$("button[type=submit]");e.html("Zoek"),e.prop("disabled",!1)}function updateSearchStatus(e){var t=e.length;status=0==t?"Geen resultaten":1==t?"1 resultaat":t+" resultaten",$("#searchStatus").html(status+" gevonden.")}$(".form-enabler-switch").each(enablingSwitches),$(".form-enabler-switch").on("change",enablingSwitches),$(".switch").on("change",buildQueryObj),$("form").on("submit",search);var queryObj={};jQuery.extend({getQueryParameters:function(e){return(e||document.location.search).replace(/(^\?)/,"").split("&").map(function(e){return e=e.split("="),this[e[0]]=e[1],this}.bind({}))[0]}}),$(document).ready(function(){init()});var cache={};$("input[data-autocomplete]").each(function(){var e=$(this);e.autocomplete({minLength:2,source:function(t,n){var i={},r=e.data("property");i.index="false"==queryObj.index?"false":"true",i[r]=t.term;var s=r+t.term+i.index;return s in cache?void n(cache[s]):void $.getJSON(baseURL+"api/suggest?",i,function(e,t,i){cache[s]=e,n(e)})},select:function(e,t){return!1},select:function(e,t){$(this).val(t.item?t.item:" ")},change:function(e,t){t.item||(this.value="")}})}),function(e,t){"use strict";var n=e.document,i;i=function(){var i={},r={},s=!1,a={ENTER:13,ESC:27,SPACE:32},o=[],l,c,u,f,d,p,h,y,b,m,v,g,k;return r={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',ok:'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',cancel:'<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},k=function(){var e,i,r=!1,s=n.createElement("fakeelement"),a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(e in a)if(s.style[e]!==t){i=a[e],r=!0;break}return{type:i,supported:r}},l=function(e){return n.getElementById(e)},i={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,buttonReverse:!1,buttonFocus:"ok",transition:t,addListeners:function(e){var t="undefined"!=typeof u,i="undefined"!=typeof c,r="undefined"!=typeof g,s="",o=this,l,p,h,y,b;l=function(t){return"undefined"!=typeof t.preventDefault&&t.preventDefault(),h(t),"undefined"!=typeof g&&(s=g.value),"function"==typeof e&&("undefined"!=typeof g?e(!0,s):e(!0)),!1},p=function(t){return"undefined"!=typeof t.preventDefault&&t.preventDefault(),h(t),"function"==typeof e&&e(!1),!1},h=function(e){o.hide(),o.unbind(n.body,"keyup",y),o.unbind(f,"focus",b),t&&o.unbind(u,"click",l),i&&o.unbind(c,"click",p)},y=function(e){var t=e.keyCode;(t===a.SPACE&&!r||r&&t===a.ENTER)&&l(e),t===a.ESC&&i&&p(e)},b=function(e){r?g.focus():!i||o.buttonReverse?u.focus():c.focus()},this.bind(f,"focus",b),this.bind(d,"focus",b),t&&this.bind(u,"click",l),i&&this.bind(c,"click",p),this.bind(n.body,"keyup",y),this.transition.supported||this.setFocus()},bind:function(e,t,n){"function"==typeof e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},handleErrors:function(){if("undefined"!=typeof e.onerror){var t=this;return e.onerror=function(e,n,i){t.error("["+e+" on line "+i+" of "+n+"]",0)},!0}return!1},appendButtons:function(e,t){return this.buttonReverse?t+e:e+t},build:function(e){var t="",n=e.type,s=e.message,a=e.cssClass||"";switch(t+='<div class="alertify-dialog">',t+='<a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus</a>',"none"===i.buttonFocus&&(t+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>'),"prompt"===n&&(t+='<div id="alertify-form">'),t+='<article class="alertify-inner">',t+=r.message.replace("{{message}}",s),"prompt"===n&&(t+=r.input),t+=r.buttons.holder,t+="</article>","prompt"===n&&(t+="</div>"),t+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',t+="</div>",n){case"confirm":t=t.replace("{{buttons}}",this.appendButtons(r.buttons.cancel,r.buttons.ok)),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":t=t.replace("{{buttons}}",this.appendButtons(r.buttons.cancel,r.buttons.submit)),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":t=t.replace("{{buttons}}",r.buttons.ok),t=t.replace("{{ok}}",this.labels.ok)}return b.className="alertify alertify-"+n+" "+a,y.className="alertify-cover",t},close:function(e,t){var n=t&&!isNaN(t)?+t:this.delay,i=this,r,s;this.bind(e,"click",function(){r(e)}),s=function(e){e.stopPropagation(),i.unbind(this,i.transition.type,s),m.removeChild(this),m.hasChildNodes()||(m.className+=" alertify-logs-hidden")},r=function(e){"undefined"!=typeof e&&e.parentNode===m&&(i.transition.supported?(i.bind(e,i.transition.type,s),e.className+=" alertify-log-hide"):(m.removeChild(e),m.hasChildNodes()||(m.className+=" alertify-logs-hidden")))},0!==t&&setTimeout(function(){r(e)},n)},dialog:function(e,t,i,r,a){h=n.activeElement;var l=function(){m&&null!==m.scrollTop&&y&&null!==y.scrollTop||l()};if("string"!=typeof e)throw new Error("message must be a string");if("string"!=typeof t)throw new Error("type must be a string");if("undefined"!=typeof i&&"function"!=typeof i)throw new Error("fn must be a function");return this.init(),l(),o.push({type:t,message:e,callback:i,placeholder:r,cssClass:a}),s||this.setup(),this},extend:function(e){if("string"!=typeof e)throw new Error("extend method must have exactly one paramter");return function(t,n){return this.log(t,e,n),this}},hide:function(){var e,t=this;o.splice(0,1),o.length>0?this.setup(!0):(s=!1,e=function(n){n.stopPropagation(),t.unbind(b,t.transition.type,e)},this.transition.supported?(this.bind(b,this.transition.type,e),b.className="alertify alertify-hide alertify-hidden"):b.className="alertify alertify-hide alertify-hidden alertify-isHidden",y.className="alertify-cover alertify-cover-hidden",h.focus())},init:function(){n.createElement("nav"),n.createElement("article"),n.createElement("section"),null==l("alertify-cover")&&(y=n.createElement("div"),y.setAttribute("id","alertify-cover"),y.className="alertify-cover alertify-cover-hidden",n.body.appendChild(y)),null==l("alertify")&&(s=!1,o=[],b=n.createElement("section"),b.setAttribute("id","alertify"),b.className="alertify alertify-hidden",n.body.appendChild(b)),null==l("alertify-logs")&&(m=n.createElement("section"),m.setAttribute("id","alertify-logs"),m.className="alertify-logs alertify-logs-hidden",n.body.appendChild(m)),n.body.setAttribute("tabindex","0"),this.transition=k()},log:function(e,t,n){var i=function(){m&&null!==m.scrollTop||i()};return this.init(),i(),m.className="alertify-logs",this.notify(e,t,n),this},notify:function(e,t,i){var r=n.createElement("article");r.className="alertify-log"+("string"==typeof t&&""!==t?" alertify-log-"+t:""),r.innerHTML=e,m.appendChild(r),setTimeout(function(){r.className=r.className+" alertify-log-show"},50),this.close(r,i)},set:function(e){var t;if("object"!=typeof e&&e instanceof Array)throw new Error("args must be an object");for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},setFocus:function(){g?(g.focus(),g.select()):p.focus()},setup:function(e){var n=o[0],r=this,a;s=!0,a=function(e){e.stopPropagation(),r.setFocus(),r.unbind(b,r.transition.type,a)},this.transition.supported&&!e&&this.bind(b,this.transition.type,a),b.innerHTML=this.build(n),f=l("alertify-resetFocus"),d=l("alertify-resetFocusBack"),u=l("alertify-ok")||t,c=l("alertify-cancel")||t,p="cancel"===i.buttonFocus?c:"none"===i.buttonFocus?l("alertify-noneFocus"):u,g=l("alertify-text")||t,v=l("alertify-form")||t,"string"==typeof n.placeholder&&""!==n.placeholder&&(g.value=n.placeholder),e&&this.setFocus(),this.addListeners(n.callback)},unbind:function(e,t,n){"function"==typeof e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}},{alert:function(e,t,n){return i.dialog(e,"alert",t,"",n),this},confirm:function(e,t,n){return i.dialog(e,"confirm",t,"",n),this},extend:i.extend,init:i.init,log:function(e,t,n){return i.log(e,t,n),this},prompt:function(e,t,n,r){return i.dialog(e,"prompt",t,n,r),this},success:function(e,t){return i.log(e,"success",t),this},error:function(e,t){return i.log(e,"error",t),this},set:function(e){i.set(e)},labels:i.labels,debug:i.handleErrors}},"function"==typeof define?define([],function(){return new i}):"undefined"==typeof e.alertify&&(e.alertify=new i)}(this);var app=angular.module("PIDdemonstrator",[]);app.controller("ResultCtrl",["$scope","$http",function(e,t){e.simple_works=[],e.normalised_works=[],e.loadWorks=function(n){t({url:baseURL+"api/query",method:"GET",params:n}).success(function(t,n,i,r){e.normalised_works=t,resetForm()}).error(function(e,t,n,i){var r=JSON.parse(e.responseText);r=r.error,alertify.error("An error occurred: "+e.status+" - "+r.message),resetForm()}),e.$apply()},e.reset=function(){e.simple_works=[],e.normalised_works=[],e.$apply()}}]),app.filter("resultCount",function(){return function(e){return status=0==e?"Geen resultaten":1==e?"1 resultaat":e+" resultaten",status+" gevonden"}});